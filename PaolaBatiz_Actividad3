/******************************************************************************

Nombre del programa: Cálculo de RFC sin Homoclave
Autor: Paola Elizabeth Bátiz González
Fecha: 1ro de Diciembre de 2025

*******************************************************************************/

#include <iostream>
#include <vector>
#include <string>
using namespace std;

// Diccionario de palabras no permitidas
const vector<string> palabrasProhibidas = {
    "PUTO", "JOTO", "FUCK", "LOCO", "PENE"
};

// Verificar y modificar palabras prohibidas del diccionario
string corregirRFC(const string& rfc) {
    // Se toman las primeras 4 letras del RFC
    string primerasCuatro = rfc.substr(0, 4);
    // Se comparan con el diccionario de palabras no permitidas
    for (const string& palabra : palabrasProhibidas) {
        if (primerasCuatro == palabra) {
            // Se reemplaza la última letra por 'X'
            return rfc.substr(0, 3) + "X";
        }
    }
    return rfc;
}

// Funcion para obtener la primera vocal interna de una cadena
char obtenerPrimeraVocalInterna(const string& str) {
    // Se inicia desde la segunda letra, nunca desde la primera
    for (size_t i = 1; i < str.length(); ++i) {
        char c = toupper(str[i]); // Convertimos a mayúscula para evitar errores
        if (c == 'A' || c == 'E' || c == 'I' || c == 'O' || c == 'U') {
            return c;             // Si es vocal, se regresa
        }
    }
    return 'X'; // Si no se encontró ninguna vocal interna
}

// Funcion principal para calcular el RFC del empleado
string calcularRFC(const string& nombre,
                   const string& apellidoPaterno,
                   const string& apellidoMaterno,
                   const string& fechaNacimiento) {
    // Copias en mayúsculas para trabajar el RFC correctamente
    string nomMay = nombre;
    string apPatMay = apellidoPaterno;
    string apMatMay = apellidoMaterno;
    for (char &c : nomMay)    c = toupper(c);
    for (char &c : apPatMay)  c = toupper(c);
    for (char &c : apMatMay)  c = toupper(c);
    // Se declara la variable donde guardaremos el RFC
    string rfc;
    // Se obtiene la letra inicial y la primera vocal interna del apellido paterno
    char letraInicial = apPatMay[0];
    char primeraVocalInterna = obtenerPrimeraVocalInterna(apPatMay);
    // Se obtiene la inicial del apellido materno o se usa una 'X' si está vacío
    char inicialApellidoMaterno = apMatMay.empty() ? 'X' : apMatMay[0];
    // Se obtiene la inicial del primer nombre
    char inicialNombre = nomMay[0];
    // Se obtienen los dos ultimos digitos del año de fechaNacimiento
    string anio = fechaNacimiento.substr(2, 2); // YY
    // Se obtiene el mes y día de nacimiento
    string mes = fechaNacimiento.substr(5, 2);  // MM
    string dia = fechaNacimiento.substr(8, 2);  // DD
    // Se construye el RFC sumando el texto de la información proporcionada
    rfc = letraInicial;
    rfc += primeraVocalInterna;
    rfc += inicialApellidoMaterno;
    rfc += inicialNombre;
    // Aquí se ejecuta la comparación de malas palabras en el diccionario y se sustituye con una X
    rfc = corregirRFC(rfc);
    // Realizar la correccion y se continua creando el RFC
    rfc += anio;
    rfc += mes;
    rfc += dia;
    return rfc;
}

int main() {
    // Escribe en consola los pasos a seguir y espera los datos en mayusculas
    string nombre, apellidoPaterno, apellidoMaterno;
    int anio, mes, dia;
    cout << "Calculo de RFC sin homoclave" << endl;
    cout << "Introduce tu nombre: ";
    getline(cin, nombre);
    cout << "Introduce tu apellido paterno: ";
    getline(cin, apellidoPaterno);
    cout << "Introduce tu apellido materno (si no cuentas con apellido materno, deja vacio y presiona ENTER): ";
    getline(cin, apellidoMaterno);
    cout << "Introduce tu anio de nacimiento (YYYY): ";
    cin >> anio;
    cout << "Introduce el mes de nacimiento (dos digitos entre 01 y 12): ";
    cin >> mes;
    while (mes < 1 || mes > 12) {
        cout << "Mes invalido. Debe estar entre 01 y 12. Intenta de nuevo: ";
        cin >> mes;
    }
    cout << "Introduce el dia de nacimiento (01 al 31): ";
    cin >> dia;
    while (dia < 1 || dia > 31) {
        cout << "Dia invalido. Debe estar entre 01 y 31. Intenta de nuevo: ";
        cin >> dia;
    }
    // Armamos la fecha en formato YYYY-MM-DD
    string anioStr = to_string(anio);
    string mesStr  = (mes < 10 ? "0" : "") + to_string(mes);
    string diaStr  = (dia < 10 ? "0" : "") + to_string(dia);
    string fechaNacimiento = anioStr + "-" + mesStr + "-" + diaStr;
    // Calculamos el RFC
    string rfc = calcularRFC(nombre, apellidoPaterno, apellidoMaterno, fechaNacimiento);
    cout << "\nRFC: " << rfc << endl;
    return 0;
}
